<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Study Planner AI</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;700&display=swap"
        rel="stylesheet">
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #6366f1;
            /* Indigo */
            --secondary-color: #ec4899;
            /* Pink */
            --accent-color: #8b5cf6;
            /* Violet */
            --bg-color: #f3f4f6;
            --text-color: #1f2937;
            --card-bg: rgba(255, 255, 255, 0.7);
            --card-border: rgba(255, 255, 255, 0.5);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --input-bg: rgba(255, 255, 255, 0.9);
            --transition-speed: 0.3s;
        }

        .dark-mode {
            --primary-color: #818cf8;
            --secondary-color: #f472b6;
            --accent-color: #a78bfa;
            --bg-color: #0f172a;
            /* Slate 900 */
            --text-color: #f1f5f9;
            --card-bg: rgba(30, 41, 59, 0.7);
            /* Slate 800 with opacity */
            --card-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            --input-bg: rgba(15, 23, 42, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: var(--bg-color);
            background-image:
                radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 1) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 1) 0, transparent 50%);
            background-attachment: fixed;
            background-size: cover;
            color: var(--text-color);
            min-height: 100vh;
            transition: background var(--transition-speed), color var(--transition-speed);
            overflow-x: hidden;
        }

        /* Glassmorphism Card Utility */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            box-shadow: var(--glass-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.2);
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--card-border);
        }

        h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.2rem;
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            fill: var(--text-color);
        }

        /* Grid Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Input Section */
        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.95rem;
        }

        input,
        select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--card-border);
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .btn-primary {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--card-border);
            color: var(--text-color);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Subject List Styling */
        .subject-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease-out;
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .remove-btn {
            color: #ef4444;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--card-border);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Timetable & Charts */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-bottom: 2rem;
        }

        .timetable-list {
            list-style: none;
        }

        .timetable-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--card-border);
            transition: background 0.2s;
        }

        .timetable-item:last-child {
            border-bottom: none;
        }

        .timetable-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .priority-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .priority-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .priority-low {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        /* Motivator & Alerts */
        .alert-box {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: none;
            animation: fadeIn 0.5s;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.4);
            color: #d97706;
        }

        .dark-mode .alert-warning {
            color: #fbbf24;
        }

        .quote-box {
            font-style: italic;
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(to right, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
            border-radius: 12px;
            margin-top: 2rem;
            border-left: 4px solid var(--primary-color);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            font-size: 0.85rem;
            opacity: 0.6;
            margin-top: 3rem;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Pomodoro Timer Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card-bg);
            /* Use theme card bg */
            /* Ensure text contrast is correct by explicitly setting color if needed, 
               though it inherits from body usually. */
            color: var(--text-color);
            padding: 2rem;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 1px solid var(--card-border);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        /* Fix for dark mode modal visibility if needed */
        .dark-mode .modal-content {
            background: #1e293b;
            /* Solid slate 800 for better opacity/contrast */
        }

        .timer-display {
            font-size: 4rem;
            font-weight: 700;
            font-family: 'Outfit', sans-serif;
            margin: 1.5rem 0;
            color: var(--primary-color);
        }

        .control-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 0.5rem;
            transition: transform 0.1s;
        }

        .btn-start {
            background: var(--primary-color);
            color: white;
        }

        .btn-stop {
            background: var(--secondary-color);
            color: white;
        }

        .btn-start:active,
        .btn-stop:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <div>
                <h1>Smart Study Planner AI</h1>
                <p class="subtitle">Designed for High Performance Students</p>
            </div>
            <div>
                <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
                    <!-- Sun Icon -->
                    <svg id="sunIcon" viewBox="0 0 24 24" style="display:none;">
                        <path
                            d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41M12 7a5 5 0 100 10 5 5 0 000-10z"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    <!-- Moon Icon -->
                    <svg id="moonIcon" viewBox="0 0 24 24">
                        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" fill="currentColor" />
                    </svg>
                </button>
            </div>
        </header>

        <div class="main-grid">
            <!-- Left Column: Inputs -->
            <div class="input-section">
                <div class="glass-card">
                    <h2 style="margin-bottom: 1.5rem;">Configuration</h2>

                    <div class="input-group">
                        <label>Exam Date</label>
                        <input type="date" id="examDate">
                    </div>

                    <div class="input-group">
                        <label>Daily Available Hours</label>
                        <input type="number" id="dailyHours" min="1" max="24" value="4">
                    </div>

                    <div class="input-group">
                        <label>Buffer Days (Before Exam)</label>
                        <input type="number" id="bufferDays" min="0" value="2">
                    </div>

                    <h3 style="margin: 1.5rem 0 1rem;">Subjects</h3>
                    <div id="subjectsList">
                        <!-- Dynamic Subject Inputs will go here -->
                    </div>

                    <button class="btn-secondary" id="addSubjectBtn"
                        style="width: 100%; margin-bottom: 1.5rem; border: 2px dashed var(--card-border);">
                        + Add Subject
                    </button>

                    <button class="btn-primary" id="generateBtn">
                        Generate Study Plan
                    </button>
                </div>

                <div class="glass-card" style="text-align: center;">
                    <h3>Tools</h3>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 1rem;">
                        <button class="btn-secondary" onclick="studyPlanner.openPomodoro()">üçÖ Pomodoro</button>
                        <button class="btn-secondary" onclick="studyPlanner.resetData()">Reset Data</button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Output -->
            <div class="output-section">
                <!-- Alerts Area -->
                <div id="alertArea" class="alert-box"></div>

                <!-- Stats Dashboard -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="daysLeft">0</div>
                        <div class="stat-label">Days Until Exam</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalStudyHours">0</div>
                        <div class="stat-label">Total Study Hours Needed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgDailyHours">0</div>
                        <div class="stat-label">Rec. Daily Study</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="glass-card">
                    <h3 style="margin-bottom: 1rem;">Study Distribution</h3>
                    <div class="chart-container">
                        <canvas id="hoursChart"></canvas>
                    </div>
                </div>

                <!-- Timetable -->
                <div class="glass-card">
                    <h3 style="margin-bottom: 1rem;">Your Personalized Schedule</h3>
                    <div id="timetable" class="timetable-list">
                        <p style="opacity: 0.6; text-align: center; padding: 2rem;">Add subjects and generate a plan to
                            see your schedule.</p>
                    </div>
                </div>

                <!-- Dynamic Motivation -->
                <div id="motivationBox" class="quote-box">
                    "Success is the sum of small efforts, repeated day in and day out."
                </div>

            </div>
        </div>

        <footer>
            <p>Built with ‚ù§Ô∏è by Smart Study Planner AI ‚Ä¢ Efficient Learning Optimized</p>
        </footer>
    </div>

    <!-- Pomodoro Modal -->
    <div id="pomodoroModal" class="modal">
        <div class="modal-content">
            <h3>Focus Mode</h3>
            <div class="timer-display" id="timerDisplay">25:00</div>
            <div>
                <button class="control-btn btn-start" id="startTimerBtn">Start</button>
                <button class="control-btn btn-stop" id="stopTimerBtn">Close</button>
            </div>
            <p style="margin-top: 1rem; opacity: 0.7;">Stay focused for 25 minutes, then take a 5 minute break.</p>
        </div>
    </div>

    <!-- Application Logic -->
    <script>
        class StudyPlanner {
            constructor() {
                this.subjects = [];
                this.chartInstance = null;
                this.timerInterval = null;

                // Initialize UI
                this.initTheme();
                this.setupEventListeners();
                this.loadData();

                if (this.subjects.length === 0) {
                    this.addSubjectInputs(); // Add one default subject field
                } else {
                    this.renderSubjectInputs();
                    this.generateSchedule(); // Regenerate on load if data exists
                }
            }

            initTheme() {
                const themeToggle = document.getElementById('themeToggle');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const savedTheme = localStorage.getItem('theme');

                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.body.classList.add('dark-mode');
                    this.updateThemeIcons(true);
                } else {
                    this.updateThemeIcons(false);
                }

                themeToggle.addEventListener('click', () => {
                    document.body.classList.toggle('dark-mode');
                    const isDark = document.body.classList.contains('dark-mode');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                    this.updateThemeIcons(isDark);
                    this.updateChartTheme();
                });
            }

            updateThemeIcons(isDark) {
                document.getElementById('sunIcon').style.display = isDark ? 'block' : 'none';
                document.getElementById('moonIcon').style.display = isDark ? 'none' : 'block';
            }

            setupEventListeners() {
                document.getElementById('addSubjectBtn').addEventListener('click', () => this.addSubjectInputs());
                document.getElementById('generateBtn').addEventListener('click', () => this.saveAndGenerate());

                // Pomodoro Controls
                document.getElementById('startTimerBtn').addEventListener('click', () => this.startTimer());
                document.getElementById('stopTimerBtn').addEventListener('click', () => this.closePomodoro());
            }

            addSubjectInputs(data = null) {
                const list = document.getElementById('subjectsList');
                const id = Date.now();
                const div = document.createElement('div');
                div.className = 'subject-item';
                div.dataset.id = id;

                const name = data ? data.name : '';
                const diff = data ? data.difficulty : 'Medium';
                const prio = data ? data.priority : 'Medium';
                const prep = data ? data.prep : 50;

                div.innerHTML = `
                    <div class="subject-header">
                        <input type="text" placeholder="Subject Name (e.g., Physics)" class="sub-name" value="${name}" style="margin-bottom:0; width: 85%;">
                        <button class="remove-btn" onclick="studyPlanner.removeSubject(${id})">&times;</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                        <div>
                            <label style="font-size: 0.8rem;">Difficulty</label>
                            <select class="sub-diff">
                                <option value="Easy" ${diff === 'Easy' ? 'selected' : ''}>Easy</option>
                                <option value="Medium" ${diff === 'Medium' ? 'selected' : ''}>Medium</option>
                                <option value="Hard" ${diff === 'Hard' ? 'selected' : ''}>Hard</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 0.8rem;">Priority</label>
                            <select class="sub-prio">
                                <option value="Low" ${prio === 'Low' ? 'selected' : ''}>Low</option>
                                <option value="Medium" ${prio === 'Medium' ? 'selected' : ''}>Medium</option>
                                <option value="High" ${prio === 'High' ? 'selected' : ''}>High</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                         <label style="font-size: 0.8rem;">Current Prep: <span class="prep-val">${prep}</span>%</label>
                         <input type="range" class="sub-prep" min="0" max="100" value="${prep}" oninput="this.previousElementSibling.firstElementChild.innerText = this.value">
                    </div>
                `;
                list.appendChild(div);
            }

            removeSubject(id) {
                const item = document.querySelector(`.subject-item[data-id="${id}"]`);
                if (item) item.remove();
            }

            renderSubjectInputs() {
                const list = document.getElementById('subjectsList');
                list.innerHTML = '';
                this.subjects.forEach(sub => this.addSubjectInputs(sub));
            }

            getInputs() {
                const subjectElems = document.querySelectorAll('.subject-item');
                const subjects = [];
                subjectElems.forEach(el => {
                    subjects.push({
                        name: el.querySelector('.sub-name').value || 'Untitled Subject',
                        difficulty: el.querySelector('.sub-diff').value,
                        priority: el.querySelector('.sub-prio').value,
                        prep: parseInt(el.querySelector('.sub-prep').value)
                    });
                });

                return {
                    examDate: document.getElementById('examDate').value,
                    dailyHours: parseFloat(document.getElementById('dailyHours').value) || 4,
                    bufferDays: parseInt(document.getElementById('bufferDays').value) || 0,
                    subjects: subjects
                };
            }

            saveAndGenerate() {
                const inputs = this.getInputs();

                if (!inputs.examDate) {
                    alert('Please select an exam date!');
                    return;
                }

                if (inputs.subjects.length === 0) {
                    alert('Please add at least one subject.');
                    return;
                }

                this.subjects = inputs.subjects;
                localStorage.setItem('studyData', JSON.stringify(inputs));

                this.generateSchedule(inputs);
            }

            loadData() {
                const data = JSON.parse(localStorage.getItem('studyData'));
                if (data) {
                    document.getElementById('examDate').value = data.examDate;
                    document.getElementById('dailyHours').value = data.dailyHours;
                    document.getElementById('bufferDays').value = data.bufferDays;
                    this.subjects = data.subjects || [];
                } else {
                    // Default to 1 month from now
                    const today = new Date();
                    today.setDate(today.getDate() + 30);
                    document.getElementById('examDate').value = today.toISOString().split('T')[0];
                }
            }

            resetData() {
                if (confirm("Are you sure you want to clear all data?")) {
                    localStorage.removeItem('studyData');
                    location.reload();
                }
            }

            calculateDaysLeft(targetDate) {
                const today = new Date();
                const exam = new Date(targetDate);
                const diffTime = exam - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays > 0 ? diffDays : 0;
            }

            generateSchedule(data = null) {
                if (!data) data = this.getInputs();
                if (!data.examDate) return;

                const daysLeft = this.calculateDaysLeft(data.examDate);
                const activeDays = daysLeft - data.bufferDays;

                // Update Dashboard
                document.getElementById('daysLeft').innerText = daysLeft;

                if (activeDays <= 0) {
                    this.showAlert("Warning: Not enough time before exam! Buffer days reduced.", "warning");
                } else {
                    document.getElementById('alertArea').style.display = 'none';
                }

                // Calculation Core
                let totalWeight = 0;
                const processedSubjects = data.subjects.map(sub => {
                    // Weights: Diff (1-3) + Prio (1-3) + (100-Prep)/20
                    let wDiff = sub.difficulty === 'Hard' ? 3 : (sub.difficulty === 'Medium' ? 2 : 1);
                    let wPrio = sub.priority === 'High' ? 3 : (sub.priority === 'Medium' ? 2 : 1);
                    let wPrep = (100 - sub.prep) / 20; // 0 to 5

                    let weight = wDiff + wPrio + wPrep;
                    totalWeight += weight;
                    return { ...sub, weight };
                });

                const totalAvailableHours = (activeDays > 0 ? activeDays : 1) * data.dailyHours;

                // Allocate hours
                let totalNeeded = 0;
                processedSubjects.forEach(sub => {
                    sub.hoursAllocated = (sub.weight / totalWeight) * totalAvailableHours;
                    sub.dailyAllocated = sub.hoursAllocated / (activeDays > 0 ? activeDays : 1);
                    totalNeeded += sub.hoursAllocated;
                });

                // Update UI Stats
                document.getElementById('totalStudyHours').innerText = Math.round(totalNeeded);

                // Alert if daily hours needed > available
                const maxDailyNeeded = Math.max(...processedSubjects.map(s => s.dailyAllocated));
                if (maxDailyNeeded > data.dailyHours) {
                    this.showAlert(`You need more daily study time! Try increasing to ${Math.round(maxDailyNeeded)} hours.`, "warning");
                }

                document.getElementById('avgDailyHours').innerText = (totalNeeded / (activeDays > 0 ? activeDays : 1)).toFixed(1);

                this.renderVisuals(processedSubjects);
                this.updateMotivation(daysLeft, processedSubjects);
            }

            showAlert(msg, type) {
                const alertBox = document.getElementById('alertArea');
                alertBox.innerText = msg;
                alertBox.style.display = 'block';
                alertBox.className = `alert-box alert-${type}`;
            }

            renderVisuals(subjects) {
                // Table
                const table = document.getElementById('timetable');
                table.innerHTML = '';

                subjects.sort((a, b) => b.weight - a.weight); // Sort by importance

                subjects.forEach(sub => {
                    const li = document.createElement('div');
                    li.className = 'timetable-item';

                    let priorityClass = sub.priority === 'High' ? 'priority-high' : (sub.priority === 'Medium' ? 'priority-medium' : 'priority-low');

                    const hours = sub.hoursAllocated.toFixed(1);
                    const daily = sub.dailyAllocated.toFixed(1);

                    li.innerHTML = `
                        <div>
                            <div style="font-weight: 600; font-size: 1.1rem;">${sub.name}</div>
                            <div style="font-size: 0.85rem; opacity: 0.7; margin-top: 4px;">Gap: ${100 - sub.prep}% ‚Ä¢ ${sub.difficulty}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 700; color: var(--primary-color);">${daily} hrs/day</div>
                            <span class="priority-badge ${priorityClass}">${sub.priority}</span>
                            <div style="font-size: 0.75rem; margin-top: 4px;">Total: ${hours}h</div>
                        </div>
                    `;
                    table.appendChild(li);
                });

                // Chart
                this.renderChart(subjects);
            }

            renderChart(subjects) {
                const ctx = document.getElementById('hoursChart').getContext('2d');

                if (this.chartInstance) {
                    this.chartInstance.destroy();
                }

                const labels = subjects.map(s => s.name);
                const data = subjects.map(s => s.hoursAllocated);
                const isDark = document.body.classList.contains('dark-mode');
                const textColor = isDark ? '#f1f5f9' : '#1f2937';

                this.chartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Hours Allocated',
                            data: data,
                            backgroundColor: [
                                '#6366f1', '#ec4899', '#8b5cf6', '#14b8a6', '#f59e0b', '#ef4444'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: textColor }
                            }
                        }
                    }
                });
            }

            updateChartTheme() {
                if (this.subjects.length > 0) {
                    this.generateSchedule(); // Re-renders chart with correct colors
                }
            }

            updateMotivation(days, subjects) {
                const quotes = [
                    "Success is the sum of small efforts, repeated day in and day out.",
                    "The secret of getting ahead is getting started.",
                    "Don't watch the clock; do what it does. Keep going.",
                    "Dream big and dare to fail.",
                    "It always seems impossible until it's done."
                ];

                let msg = quotes[Math.floor(Math.random() * quotes.length)];

                if (days < 5) msg = "Crunch time! Focus on your high priority subjects now.";
                if (days > 30) msg = "Great connection! Consistency is key for long term retention.";

                document.getElementById('motivationBox').innerText = `"${msg}"`;
            }

            // Pomodoro Logic
            openPomodoro() {
                document.getElementById('pomodoroModal').style.display = 'flex';
            }

            closePomodoro() {
                document.getElementById('pomodoroModal').style.display = 'none';
                clearInterval(this.timerInterval);
                this.timerInterval = null;
                document.getElementById('timerDisplay').innerText = "25:00";
                document.getElementById('startTimerBtn').innerText = "Start";
            }

            startTimer() {
                const display = document.getElementById('timerDisplay');
                const btn = document.getElementById('startTimerBtn');

                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                    btn.innerText = "Start";
                    return;
                }

                btn.innerText = "Pause";
                let timeLeft = 25 * 60;

                this.timerInterval = setInterval(() => {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    display.innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                    if (timeLeft <= 0) {
                        clearInterval(this.timerInterval);
                        display.innerText = "Break!";
                        new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play();
                    }
                    timeLeft--;
                }, 1000);
            }
        }

        // Initialize App
        const studyPlanner = new StudyPlanner();
    </script>
</body>

</html>